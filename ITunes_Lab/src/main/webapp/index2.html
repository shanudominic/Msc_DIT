<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="shortcut icon" type="image/x-icon" href="media/images/DIT.ico" />
  	<title>Admin.html</title>
  	<meta charset="utf-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1">
  	<script type="text/javascript">
	  	var type = window.sessionStorage.getItem("UserName");
		
		if(type == null){
			window.location.replace("http://localhost:8080/ITunes_Lab");
		}
  	</script>
  	<!-- Bootstrap stylesheet -->
  	<link rel="stylesheet" href="media/css/bootstrap.min.css" type="text/css">
  	<!-- bootstrap widget theme -->
	<link id="css" href="media/css/theme.bootstrap.css" rel="stylesheet" type="text/css" />
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<!-- tablesorter plugin -->
	<script src="media/js/jquery.tablesorter.js"></script>
	<!-- tablesorter widget file - loaded after the plugin -->
	<script src="media/js/jquery.tablesorter.widgets.js"></script>
	<!-- pager plugin -->
	<link rel="stylesheet" href="media/css/jquery.tablesorter.pager.css" type="text/css">
	<script src="media/js/jquery.tablesorter.pager.js"></script>
	<!-- Table sorter function -->
	<script src="media/js/tableSorter.js"></script>
	
  	<link rel="stylesheet" href="media/css/Design.css" type="text/css">
  	<link rel="stylesheet" href="media/css/bootstrap-datetimepicker.css" type="text/css">

  	<script src="media/js/bootstrap.min.js"></script>
 	<script src="media/js/moment-with-locales.js"></script>
	<script src="media/js/transition.js"></script>
	<script src="media/js/collapse.js"></script>
	<script src="media/js/bootstrap-datetimepicker.min.js"></script>

	
</head>
<body onload="hideTable()">
	<div class="container basedata">
	<img title="Ericsson Logo" src="media/images/DIT.png" id="ericsson" alt="logo" width="100px" />
	  <h2><i>ITunes Backup</i></h2>
	  <h3 id="welcomeUser"></h3>
	  <br>
	  <ul class="nav nav-pills">
<!-- 	  	<li><a id="back" data-toggle="pill" href="">Go Back</a></li> -->
<!-- 	    <li class="active" title="Home"><a data-toggle="pill" href="#home">Home</a></li> -->
	    <li class="active" title="Click to select import menu"><a id="semenu1"  data-toggle="pill" href="#home">Import Data</a></li>
	    <li title="Click to view Data from database"><a id="semenu2" data-toggle="pill" href="#menu2">View Data</a></li>
	    <li title="Click to edit playlist details"><a id="semenu3" data-toggle="pill" href="#menu3">Edit PlayList</a></li>
	    <li title="Click to remove a track from a device backup"><a id="semenu4" data-toggle="pill" href="#menu4">Remove Track</a></li>
	   	<li title="Click to logout"><a id="logout" data-toggle="pill" href="#">Log out</a></li>
	  </ul>
	  <hr>
	  <div class="tab-content">
	     <div id="home" class="tab-pane fade in active"> 
		      <div class="fixed">
		      	<blockquote>
					<h3 class="title">Import Data from <i>XML</i> to DataBase</h3>
				</blockquote>
				<div id="formDiv">
				<br>
				<form id="form1">
				   <p>
					Select a file : <input type="file" name="uploadedFile" id="uploadedFile" size="50" >
				   </p>
			
				   <button class="btn btn-info" title="Import Data from iTunes Music Library.xml" type="button" onclick="sendForm()">Upload It</button>
					<br><br>
				</form>
				</div>
	      	</div>
	    </div>
	    <div id="menu2" class="tab-pane fade">
	      <div class="fixed">
	      	<blockquote>
				<h3 class="title">View Data from DataBase</h3>
			</blockquote>
			<div id="section">
				<div class="table-responsive">
					<table id="UserLibrary2" class="tablesorter">
						<thead>
							<tr>
								<th>No</th>
								<th>Device ID</th>
								
							</tr>
						</thead>
						<tfoot>
							<tr>
								<th>No</th>
								<th>Device ID</th>
							</tr>
							
						</tfoot>
						<tbody>

						</tbody>
					</table>
				</div>
				<br><br>
				<div class="table-responsive">
					<table id="Playlist" class="tablesorter">
						<thead>
							<tr>
								<th>PlayList ID</th>
								<th>PlayList Name</th>
								
							</tr>
						</thead>
						<tfoot>
							<tr>
								<th>PlayList ID</th>
								<th>PlayList Name</th>
							</tr>
							<tr>
								<th colspan="2" id="pager2" class="ts-pager form-horizontal">
								<span>Show
								</span> <select class="pagesize input-mini" title="Select page size">
										<option selected="selected" value="5">5</option>
										<option value="10">10</option>
										<option value="20">20</option>
										<option value="30">30</option>
								</select>
									<div id="pagination">
										<button type="button" class="btn first">
											<span>First</span> <i
												class="icon-step-backward glyphicon glyphicon-step-backward"></i>
										</button>
										<button type="button" class="btn prev">
											<span>Prev</span> <i
												class="icon-arrow-left glyphicon glyphicon-backward"></i>
										</button>
										<span class="pagedisplay"></span>
										<button type="button" class="btn next">
											<span>Next</span> <i
												class="icon-arrow-right glyphicon glyphicon-forward"></i>
										</button>
										<button type="button" class="btn last">
											<span>Last</span> <i
												class="icon-step-forward glyphicon glyphicon-step-forward"></i>
										</button>
									</div></th>
							</tr>
						</tfoot>
						<tbody>

						</tbody>
					</table>
				</div>
			</div>
			<div id="aside">
				<div class="table-responsive">
					<table id="PlaylistTrack" class="tablesorter">
						<thead>
							<tr>
								<th>Track Name</th>
								<th>Track Album</th>
								<th>Track Artist</th>
								<th>Track Composer</th>
								<th>Track Genre</th>
								
							</tr>
						</thead>
						<tfoot>
							<tr>
								<th>Track Name</th>
								<th>Track Album</th>
								<th>Track Artist</th>
								<th>Track Composer</th>
								<th>Track Genre</th>
							</tr>
							<tr>
								<th colspan="5" id="pager1" class="ts-pager form-horizontal">
								<span>Show
								</span> <select class="pagesize input-mini" title="Select page size">
										<option selected="selected" value="10">10</option>
										<option value="20">20</option>
										<option value="30">30</option>
										<option value="40">40</option>
								</select> <span> Entries</span>
									<div id="pagination">
										<button type="button" class="btn first">
											<span>First</span> <i
												class="icon-step-backward glyphicon glyphicon-step-backward"></i>
										</button>
										<button type="button" class="btn prev">
											<span>Prev</span> <i
												class="icon-arrow-left glyphicon glyphicon-backward"></i>
										</button>
										<span class="pagedisplay"></span>
										<button type="button" class="btn next">
											<span>Next</span> <i
												class="icon-arrow-right glyphicon glyphicon-forward"></i>
										</button>
										<button type="button" class="btn last">
											<span>Last</span> <i
												class="icon-step-forward glyphicon glyphicon-step-forward"></i>
										</button>
									</div></th>
							</tr>
						</tfoot>
						<tbody>

						</tbody>
					</table>
					<p></p>
				</div>
				</div>
			</div>
			</div>
		<div id="menu3" class="tab-pane fade">
	      <div class="fixed">
	      	<blockquote>
				<h3 class="title">Edit PlayList details</h3>
			</blockquote>
			
			<!-- Columns start at 50% wide on mobile and bump up to 33.3% wide on desktop -->
			<div class="row">
				<div class="col-xs-6 col-md-4">
					<div class="table-responsive">
					<table id="UserLibrary1" class="tablesorter">
						<thead>
							<tr>
								<th>No</th>
								<th>Device ID</th>
							</tr>
						</thead>
						<tfoot>
							<tr>
								<th>No</th>
								<th>Device ID</th>
							</tr>
						</tfoot>
						<tbody>
						
						</tbody>
					</table>
				</div>
				</div>
			
				<div class="col-xs-6 col-md-4">
					<div id="one1" class="table-responsive">
					<table id="Playlist1" class="tablesorter">
						<thead>
							<tr>
								<th>PlayList ID</th>
								<th>PlayList Name</th>
								
							</tr>
						</thead>
						<tfoot>
							<tr>
								<th>PlayList ID</th>
								<th>PlayList Name</th>
							</tr>
							<tr>
								<th colspan="2" id="pager22" class="ts-pager form-horizontal">
								<span>Show
								</span> <select class="pagesize input-mini" title="Select page size">
										<option selected="selected" value="5">5</option>
										<option value="10">10</option>
										<option value="20">20</option>
										<option value="30">30</option>
								</select>
									<div id="pagination">
										<button type="button" class="btn first">
											<span>First</span> <i
												class="icon-step-backward glyphicon glyphicon-step-backward"></i>
										</button>
										<button type="button" class="btn prev">
											<span>Prev</span> <i
												class="icon-arrow-left glyphicon glyphicon-backward"></i>
										</button>
										<span class="pagedisplay"></span>
										<button type="button" class="btn next">
											<span>Next</span> <i
												class="icon-arrow-right glyphicon glyphicon-forward"></i>
										</button>
										<button type="button" class="btn last">
											<span>Last</span> <i
												class="icon-step-forward glyphicon glyphicon-step-forward"></i>
										</button>
									</div></th>
							</tr>
						</tfoot>
						<tbody>

						</tbody>
					</table>
				</div>
				</div>
				
				<div class="col-xs-6 col-md-4">
					<div id="two2">
					<form id="edit">
					    <label for="PlayListID">PlayList ID</label>
					    <input type="text" class="form-control" id="PlayListID" placeholder="Playlist ID" disabled>
					    <label for="playlistname">PlayList Name</label>
					    <input type="text" class="form-control" id="playlistname" placeholder="PlayList Name" style="color: red;font-style: oblique;">
					    <br>
					  	<button id="save" type="button" class="btn btn-warning">Save</button>
					  	<button id="cancelSave" type="button" class="btn btn-info">Cancel</button>
					</form>
				</div>
				</div>

			</div>
			<br><br>
			</div>
			</div>
			
			<div id="menu4" class="tab-pane fade">
		      <div class="fixed">
		      	<blockquote>
					<h3 class="title">Delete a Track</h3>
				</blockquote>
				<div class="row">
					<div class="col-xs-6">
						<div class="table-responsive">
							<table id="Track1" class="tablesorter">
								<thead>
									<tr>
										<th>Track ID</th>
										<th>Track Name</th>
										<th>Track Album</th>
										<th>Track Artist</th>
										<th>Track Composer</th>
										<th>Track Genre</th>
									</tr>
								</thead>
								<tfoot>
									<tr>
										<th>Track ID</th>
										<th>Track Name</th>
										<th>Track Album</th>
										<th>Track Artist</th>
										<th>Track Composer</th>
										<th>Track Genre</th>
									</tr>
									<tr>
										<th colspan="6" id="pager41" class="ts-pager form-horizontal">
										<span>Show
										</span> <select class="pagesize input-mini" title="Select page size">
												<option selected="selected" value="10">10</option>
												<option value="20">20</option>
												<option value="30">30</option>
												<option value="40">40</option>
										</select> <span> Entries</span>
										<div id="pagination">
											<button type="button" class="btn first">
												<span>First</span> <i
														class="icon-step-backward glyphicon glyphicon-step-backward"></i>
											</button>
											<button type="button" class="btn prev">
												<span>Prev</span> <i
														class="icon-arrow-left glyphicon glyphicon-backward"></i>
											</button>
											<span class="pagedisplay"></span>
											<button type="button" class="btn next">
												<span>Next</span> <i
														class="icon-arrow-right glyphicon glyphicon-forward"></i>
											</button>
											<button type="button" class="btn last">
												<span>Last</span> <i
														class="icon-step-forward glyphicon glyphicon-step-forward"></i>
											</button>
										</div></th>
									</tr>
								</tfoot>
								<tbody>

								</tbody>
							</table>
						</div>
					</div>
					<div class="col-xs-6">
						<div id="two3">
							<form id="edit">
							    <label for="TrackID">Track ID</label>
							    <input type="text" class="form-control" id="TrackID" placeholder="Track ID" disabled>
							    <label for="Trackname">Track Name</label>
							    <input type="text" class="form-control" id="Trackname" placeholder="Track Name" style="color: red;font-style: oblique;" disabled>
							    <br>
							  	<button id="delete" type="button" class="btn btn-warning">Delete</button>
							  	<button id="cancelDelete" type="button" class="btn btn-info">Cancel</button>
							</form>
						</div>
					</div>					
				</div>
				<br>
				</div>
				</div>
	  </div>
	</div>
	<script type="text/javascript">
	function hideTable() {
		document.getElementById("welcomeUser").innerHTML = "Welcome "+window.sessionStorage.getItem("UserName");
		document.getElementById("UserLibrary2").style.display = "none";
		document.getElementById("UserLibrary1").style.display = "none";
		document.getElementById("Playlist").style.display = "none";
		document.getElementById("Playlist1").style.display = "none";
		document.getElementById("PlaylistTrack").style.display = "none";
		if(window.sessionStorage.getItem("greeting") == "true"){
			alert("Welcome back "+window.sessionStorage.getItem("UserName"));
			window.sessionStorage.setItem("greeting", "false");
		}
		document.getElementById("two2").style.visibility = "hidden";
	}
	
	function sendForm(){
		var val = $('#uploadedFile').val().split('\\')[2];
		if(val==undefined)
			window.alert("Please choose a file");
		else{
			var new_Path = '/home/shanu/git/Msc_DIT/ITunes_Lab/'+val;
			var my_arr = [];
			 my_arr.push(new_Path);
			 my_arr.push(window.sessionStorage.getItem("UserName"));
			 var jsonString = JSON.stringify(my_arr);
			 
			 $.ajax({
					type : 'POST',
					url : 'rest/xml/populateDB/',
					contentType : "application/json",
					data : jsonString,
					 success: function(data, textStatus, xhr) {
						 console.log(xhr.status);
					},
					error: function(xhr, textStatus, status, error){
						 if(xhr.status==200)
							 window.alert("Data successfully added");
						 else
							 window.alert("This device belongs to another user. \nPlease try agin with your device backup");
					},
					done: function(data){
						alert(data);
					}
			 });
		}
	}	
	function getUserLibraries() {
		hideTable();
		 $.ajax({
				type: 'GET',
				url : 'rest/user/getUserLibraries/'+window.sessionStorage.getItem("UserName"),
				contentType: "application/json",
// 				data: (window.sessionStorage.getItem("UserName")),
				success: function(data){
					if(data==""){
						window.alert("No Data");
					}
					else{
						$("#UserLibrary2 tbody").empty();
	 					markup0 =[];
	 					$.each(data, function(i, library){
							markup0.push("<tr>");
							markup0.push("<td>" + (i+1) + "</td>");
							markup0.push("<td>" + library.uniqueId + "</td>");
							markup0.push("</tr>");
							
	 					})
	 					$("#UserLibrary2 tbody").append(markup0.join(""));
	 					$("#UserLibrary2").trigger('update');
	 					document.getElementById("UserLibrary2").style.display = "table";
					}
				}
		 })
// 		 console.log($("#UserLibrary tbody").children().length);
	}
	
	 $(function (){
		 $('#UserLibrary2 tbody').on("click", "tr", function(e){
			 document.getElementById("PlaylistTrack").style.display = "none";
			
			 var x = document.getElementById("UserLibrary2").getElementsByTagName("tbody")[0].getElementsByTagName("td").length;
			 for(i=0; i<x; i++){
				 $('#UserLibrary2 tbody tr td').eq(i).css("backgroundColor","");
			 }
			 $('td', this).css({ 'background-color' : 'yellow' });
			 
			 var deviceID = $(this).find('td').last().text();
				 $.ajax({
						type: 'GET',
						url : 'rest/user/getDevicePlaylist/'+deviceID,
						contentType: "application/json",
// 						data: deviceID,
						success: function(data){
							if(data==""){
								window.alert("No data");
							}
							else{
								$("#Playlist tbody").empty();
			 					markup1 = [];
			 					$.each(data, function(i, playlist){
	// 		  						console.log(i +" "+playlist.playlistId);
	// 		 						var row =  $("<tr><td>" + playlist.playlistId
	// 								 + "</td><td>" + playlist.playlistName
	// 								 +"</td></tr>");
	// 		 						$("#Playlist tbody").append(row); 
			 						markup1.push("<tr>");
									markup1.push("<td>" + playlist.playlistId + "</td>");
									markup1.push("<td>" + playlist.playlistName + "</td>");
									markup1.push("</tr>");
			 					})
			 					$("#Playlist tbody").append(markup1.join("")); 
			 					$("#Playlist").trigger('update');
			 					document.getElementById("Playlist").style.display = "table";
							}
						}
				 })
			});
		 
		 $('#Playlist tbody').on("click", "tr", function(e){
			 document.getElementById("PlaylistTrack").style.display = "none";
				
			 var x = document.getElementById("Playlist").getElementsByTagName("tbody")[0].getElementsByTagName("td").length;
// 			 console.log(x);
			 for(i=0; i<x; i++){
				 $('#Playlist tbody tr td').eq(i).css("backgroundColor","");
			 }
			 $('td', this).css({ 'background-color' : 'yellow' });
			 
			 var playlistID = $(this).find('td').first().text();
				$.ajax({
						type: 'GET',
						url : 'rest/user/getPlaylistTracks/'+playlistID,
						contentType: "application/json",
// 						data: playlistID,
						success: function(data){
							$("#PlaylistTrack tbody").empty();
							markup2 = [];
							if(data==""){
								var message = "**********************  NO DATA  **********************";
								markup2.push("<tr>");
								markup2.push(" <td colspan='5'>"+ message+ "</td>");
								markup2.push("</tr>");
								$("#PlaylistTrack tbody").append(markup2.join(""));
			 					$("#PlaylistTrack").trigger('update');
			 					document.getElementById("PlaylistTrack").style.display = "table";
								window.alert("No data");
							}
							else{
// 								$("#PlaylistTrack tr.odd").remove();
// 								$("#PlaylistTrack tr.even").remove();
// 								markup2 = [];
			 					$.each(data, function(i, playlistTrack){
	// 		  						console.log(i +" "+playlistTrack[1]);
	// 		 						var row =  $("<tr><td>" + playlistTrack.track.trackName
	// 								 + "</td><td>" + playlistTrack.track.album
	// 								 + "</td><td>" + playlistTrack.track.artist
	// 								 + "</td><td>" + playlistTrack.track.composer
	// 								 + "</td><td>" + playlistTrack.track.genre
	// 								 +"</td></tr>");
	// 		 						$("#PlaylistTrack tbody").append(row); 
			 						markup2.push("<tr>");
									markup2.push("<td>" + playlistTrack[0] + "</td>");
									markup2.push("<td>" + playlistTrack[1] + "</td>");
									markup2.push("<td>" + playlistTrack[2] + "</td>");
									markup2.push("<td>" + playlistTrack[3] + "</td>");
									markup2.push("<td>" + playlistTrack[4] + "</td>");
									markup2.push("</tr>");
			 					})
			 					$("#PlaylistTrack tbody").append(markup2.join(""));
			 					$("#PlaylistTrack").trigger('update');
			 					 document.getElementById("PlaylistTrack").style.display = "table";
							}
						}
				 
				 })
			});
	 $('#semenu2').on('click', function(){
		 getUserLibraries();
	 });
		 
		 $('#submit').on('click', function(){
// 			 var file = ('/home/shanu/workspace/ITunes_Lab/iTunes Music Library1.xml');
			 var location = ['Please select a file'];
			 location.push('/home/shanu/git/Msc_DIT/ITunes_Lab/iTunes Music Library1.xml');
			 location.push('/home/shanu/git/Msc_DIT/ITunes_Lab/iTunes Music Library2.xml');
			 location.push('/home/shanu/git/Msc_DIT/ITunes_Lab/iTunes Music Library3.xml');
			 location.push('/home/shanu/git/Msc_DIT/ITunes_Lab/iTunes Music Library4.xml');
			 var file1 = $('#select_Data').val();
			 
			 if(file1=="None")
				 window.alert(location[0]);
			 else if(file1 =="1"){ 
				 var my_arr = [];
				 var file = location[1];
				 my_arr.push(file);
				 my_arr.push(window.sessionStorage.getItem("UserName"));
				 var jsonString = JSON.stringify(my_arr);
				 $.ajax({
						type : 'POST',
						url : 'rest/xml/populateDB/',
						contentType : "application/json",
						data : jsonString,
						 success: function(data, textStatus, xhr) {
							 console.log(xhr.status);
						},
						error: function(xhr, textStatus, status, error){
							 if(xhr.status==200)
								 window.alert("Data successfully added");
							 else{
								var errorMessage = xhr.responseText;
								if(errorMessage.indexOf("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: org.hibernate.HibernateException: ") > -1){
									var arr = errorMessage.split("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: org.hibernate.HibernateException: ");
									window.alert("************************ ERROR ************************ \n" + arr[1].split("org")[0]+
											"");
								}
								else if(errorMessage.indexOf("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: ")){
									var arr = (errorMessage.split("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: "));
									window.alert("************************ ERROR ************************ \n" + arr[1].split("org")[0]+
									"");
								}
								
							 }
						}
			 	})
			 }
			 else if(file1 == "2"){
				 var my_arr = [];
				 var file = location[2];
				 my_arr.push(file);
				 my_arr.push(window.sessionStorage.getItem("UserName"));
				 var jsonString = JSON.stringify(my_arr);
				 $.ajax({
						type : 'POST',
						url : 'rest/xml/populateDB/',
						contentType : "application/json",
						data : jsonString,
						 success: function(data, textStatus, xhr) {
							 console.log(xhr.status);
						},
						error: function(xhr, textStatus, status, error){
							 if(xhr.status==200)
								 window.alert("Data successfully added");
							 else{
								var errorMessage = xhr.responseText;
								if(errorMessage.indexOf("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: org.hibernate.HibernateException: ") > -1){
									var arr = errorMessage.split("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: org.hibernate.HibernateException: ");
									window.alert("************************ ERROR ************************ \n" + arr[1].split("org")[0]+
											"");
								}
							 }
						}
			 	})
			 }
			 else if(file1 == "3"){
				 var my_arr = [];
				 var file = location[3];
				 my_arr.push(file);
				 my_arr.push(window.sessionStorage.getItem("UserName"));
				 var jsonString = JSON.stringify(my_arr);
				 $.ajax({
						type : 'POST',
						url : 'rest/xml/populateDB/',
						contentType : "application/json",
						data : jsonString,
						 success: function(data, textStatus, xhr) {
							 console.log(xhr.status);
						},
						error: function(xhr, textStatus, status, error){
							 if(xhr.status==200)
								 window.alert("Data successfully added");
							 else{
								var errorMessage = xhr.responseText;
								if(errorMessage.indexOf("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: org.hibernate.HibernateException: ") > -1){
									var arr = errorMessage.split("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: org.hibernate.HibernateException: ");
									window.alert("************************ ERROR ************************ \n" + arr[1].split("org")[0]+
											"");
								}
							 }
						}
			 	})
			 }
			 else if(file1 =="4"){
				 var my_arr = [];
				 var file = location[4];
				 my_arr.push(file);
				 my_arr.push(window.sessionStorage.getItem("UserName"));
				 var jsonString = JSON.stringify(my_arr);
				 $.ajax({
						type : 'POST',
						url : 'rest/xml/populateDB/',
						contentType : "application/json",
						data : jsonString,
						 success: function(data, textStatus, xhr) {
							 console.log(xhr.status);
						},
						error: function(xhr, textStatus, status, error){
							 if(xhr.status==200)
								 window.alert("Data successfully added");
							 else{
								var errorMessage = xhr.responseText;
								if(errorMessage.indexOf("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: org.hibernate.HibernateException: ") > -1){
									var arr = errorMessage.split("org.jboss.resteasy.spi.UnhandledException: javax.ejb.EJBTransactionRolledbackException: org.hibernate.HibernateException: ");
									window.alert("************************ ERROR ************************ \n" + arr[1].split("org")[0]+
											"");
								}
					
								else if(errorMessage.indexOf("[org.xml.sax.SAXParseException; systemId: ") > -1){
									var arr = errorMessage.split("[org.xml.sax.SAXParseException; systemId: ");
								
									window.alert("************************ ERROR ************************ \n" +
											"The server encountered an internal error that prevented it from fulfilling this request. \n"+
											decodeURI(arr[1].split("org")[0]).replace('&quot;', '"').replace('&quot;', '"').replace('&quot;', '"')
											.replace('&quot;', '"').replace('&lt;','<').replace('&gt;','>')+
											"");
								}
							 }
						}
			 	})
			 }
		 });
		 $('#logout').on("click",function(){
			 sessionStorage.clear();
			 localStorage.clear();
			 window.location.replace("http://localhost:8080/ITunes_Lab/");
		 });
		 
	 });
	</script>
	<script type="text/javascript">
	function getUpdatedPlayList(deviceId){
		$.ajax({
			type: 'GET',
			url : 'rest/user/getDevicePlaylist/'+deviceId,
			contentType: "application/json",
			success: function(data){
				if(data==""){
					window.alert("No data");
				}
				else{
					$("#Playlist1 tbody").empty();
 					markup1 = [];
 					$.each(data, function(i, playlist){
 						markup1.push("<tr>");
						markup1.push("<td>" + playlist.playlistId + "</td>");
						markup1.push("<td>" + playlist.playlistName + "</td>");
						markup1.push("</tr>");
 					})
 					$("#Playlist1 tbody").append(markup1.join("")); 
 					$("#Playlist1").trigger('update');
 					document.getElementById("Playlist1").style.display = "table";
				}
			}
	 })
	};
	function getUserEditLibraries() {
		hideTable();
		 $.ajax({
				type: 'GET',
				url : 'rest/user/getUserLibraries/'+window.sessionStorage.getItem("UserName"),
				contentType: "application/json",
// 				data: (window.sessionStorage.getItem("UserName")),
				success: function(data){
					if(data==""){
						window.alert("No Data");
					}
					else{
						$("#UserLibrary1 tbody").empty();
	 					markup0 =[];
	 					$.each(data, function(i, library){
							markup0.push("<tr>");
							markup0.push("<td>" + (i+1) + "</td>");
							markup0.push("<td>" + library.uniqueId + "</td>");
							markup0.push("</tr>");
							
	 					})
	 					$("#UserLibrary1 tbody").append(markup0.join(""));
	 					$("#UserLibrary1").trigger('update');
	 					document.getElementById("UserLibrary1").style.display = "table";
					}
				}
		 })
	};
	
	$(function (){
		$('#semenu3').on('click', function(){
			getUserEditLibraries();
		});
		
		$('#UserLibrary1 tbody').on("click", "tr", function(e){
			document.getElementById("two2").style.visibility = "hidden";
			
			 var x = document.getElementById("UserLibrary1").getElementsByTagName("tbody")[0].getElementsByTagName("td").length;
			 for(i=0; i<x; i++){
				 $('#UserLibrary1 tbody tr td').eq(i).css("backgroundColor","");
			 }
			 $('td', this).css({ 'background-color' : 'yellow' });
			 
			 var deviceID = $(this).find('td').last().text();
			 window.sessionStorage.setItem("DeviceId", deviceID);
				 $.ajax({
						type: 'GET',
						url : 'rest/user/getDevicePlaylist/'+deviceID,
						contentType: "application/json",
						success: function(data){
							if(data==""){
								window.alert("No data");
							}
							else{
								$("#Playlist1 tbody").empty();
			 					markup1 = [];
			 					$.each(data, function(i, playlist){
			 						markup1.push("<tr>");
									markup1.push("<td>" + playlist.playlistId + "</td>");
									markup1.push("<td>" + playlist.playlistName + "</td>");
									markup1.push("</tr>");
			 					})
			 					$("#Playlist1 tbody").append(markup1.join("")); 
			 					$("#Playlist1").trigger('update');
			 					document.getElementById("Playlist1").style.display = "table";
							}
						}
				 })
			});
			
		$('#Playlist1 tbody').on("click", "tr", function(e){
// 			 document.getElementById("PlaylistTrack").style.display = "none";
				
			 var x = document.getElementById("Playlist1").getElementsByTagName("tbody")[0].getElementsByTagName("td").length;
			 for(i=0; i<x; i++){
				 $('#Playlist1 tbody tr td').eq(i).css("backgroundColor","");
			 }
			 $('td', this).css({ 'background-color' : 'yellow' });
			 
			 var playlistID = $(this).find('td').first().text();
			 document.getElementById("PlayListID").value = $(this).find('td').first().text();
			 document.getElementById("playlistname").value = $(this).find('td').last().text();
			 document.getElementById("two2").style.visibility = "visible";
			 $('#playlistname').focus();
			 
			});
		
		$('#save').on("click",function(){
			 var my_arr = [];
			 my_arr.push($("#PlayListID").val());
			 my_arr.push($("#playlistname").val());
			 var jsonString = JSON.stringify(my_arr);
				$.ajax({
						type: 'POST',
						url : 'rest/user/updatePlayList/',
						contentType: "application/json",
						data: jsonString,
						success: function(data){
							document.getElementById("two2").style.visibility = "hidden";
							window.alert('successfully updated');
							getUpdatedPlayList(window.sessionStorage.getItem("DeviceId"));
						},
						error: function(data){
							window.alert('Error occured while Updating Playlist Name. \nPlease try again');
							$('#playlistname').focus();
						}
				 
				 })
		});
		$('#cancelSave').on("click",function(){
			document.getElementById("two2").style.visibility = "hidden";
			getUpdatedPlayList(window.sessionStorage.getItem("DeviceId"));
		});
		
	});
	</script>
	<script type="text/javascript">
		function getTracks(username){
			document.getElementById("two3").style.visibility = "hidden";
			 $.ajax({
					type: 'GET',
					url : 'rest/user/getUserPlayListTracks/'+username,
					contentType: "application/json",
					success: function(data){
						if(data==""){
							window.alert("No Data");
						}
						else{
							$("#Track1 tbody").empty();
		 					markup41 =[];
		 					$.each(data, function(i, track){
								markup41.push("<tr>");
								markup41.push("<td>"+track.trackPK+"</td>");
								markup41.push("<td>"+track.trackName+"</td>");
								markup41.push("<td>"+track.album+"</td>");
								markup41.push("<td>"+track.artist+"</td>");
								markup41.push("<td>"+track.composer+"</td>");
								markup41.push("<td>"+track.genre+"</td>");
								markup41.push("</tr>");
		 					})
		 					$("#Track1 tbody").append(markup41.join(""));
		 					$("#Track1").trigger('update');
						}
					}
			 })
		};
		
		$(function (){
			$('#semenu4').on('click', function(){
				getTracks(window.sessionStorage.getItem("UserName"));
			});
			
			$('#Track1 tbody').on("click", "tr", function(e){
				document.getElementById("two3").style.visibility = "hidden";
				
				 var x = document.getElementById("Track1").getElementsByTagName("tbody")[0].getElementsByTagName("td").length;
				 for(i=0; i<x; i++){
					 $('#Track1 tbody tr td').eq(i).css("backgroundColor","");
				 }
				 $('td', this).css({ 'background-color' : 'yellow' });
				 var trackID = $(this).find('td').first().text();

				 document.getElementById("TrackID").value = $(this).find('td').first().text();
				 document.getElementById("Trackname").value = $(this).find('td').first().next().text();
				 document.getElementById("two3").style.visibility = "visible";
				
// 				 $.ajax({
// 						type: 'POST',
// 						url : 'rest/user/removeTrack/',
// 						contentType: "application/json",
// 						data: trackID,
// 						success: function(data){
// 							alert("successfully removed track");
// 						},
// 						error: function(data){
// 							window.alert('Error occured while removing Track. \nPlease try again');
							
// 						}
				 
// 				 })
			});
			
			$('#delete').on("click",function(){
					$.ajax({
							type: 'POST',
							url : 'rest/user/removeTrack/',
							contentType: "application/json",
							data: JSON.stringify($("#TrackID").val()),
							success: function(data){
								document.getElementById("two3").style.visibility = "hidden";
								alert("successfully removed track");
								getTracks(window.sessionStorage.getItem("UserName"));
							},
							error: function(data){
								window.alert('Error occured while removing Track. \nPlease try again');
							}
					 
					 })
			});
			$('#cancelDelete').on("click",function(){
				document.getElementById("two3").style.visibility = "hidden";
				getTracks(window.sessionStorage.getItem("UserName"));
			});
		});
	</script>
</body>
</html>
